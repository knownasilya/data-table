!function(e){var t=(e.ObjectController.extend({}),e.Component.extend({classNameBindings:["over"],dragOver:function(e){e.preventDefault()},drop:function(e){var t,n=JSON.parse(e.dataTransfer.getData("application/json")),a=this.get("columns"),i=this.get("parentView.columns"),r=this.get("parentView.requiredHeaderItem");a.findBy("name",n.name)||r.name===n.name||(t=this.get("parentView.availableColumns").findBy("name",n.name),this.get("columns").pushObject(t),t&&this.set("parentView.columns",i.without(t)))},dragEnter:function(){this.set("over",!0)},dragLeave:function(){this.set("over",!1)}})),n=e.Component.extend({classNames:["label","label-default"],attributeBindings:["draggable"],draggable:"true",dragStart:function(e){var t={id:this.get("elementId"),name:this.get("content.name")};e.dataTransfer.setData("application/json",JSON.stringify(t))},dragEnd:function(){}}),a=e.CollectionView.extend({tagName:"tr",content:e.computed.alias("parentView.columns"),classNameBindings:["over"],columnsNotInHeader:e.computed.alias("parentView.binComponent.columns"),itemViewClass:e.View.extend({elementId:e.computed.alias("name"),templateName:"components/data-table-header-collection-item",classNameBindings:["dropSide"],tagName:"td",dropSide:null,target:e.computed.alias("parentView"),dragOver:function(t){e.run.throttle(this,function(){console.log(this.get("elementId")),t.originalEvent.offsetX>this.$().width()/2?(console.log("right"),this.set("dropSide","right")):(console.log("left"),this.set("dropSide","left"))},150)},dragLeave:function(){this.set("dropSide",null)},drop:function(){var e=this.get("dropSide"),t=JSON.parse(event.dataTransfer.getData("application/json")),n=this.get("parentView.parentView.availableColumns").findBy("name",t.name);"left"===e?this.send("insertBefore",this.get("content"),n):this.send("insertAfter",this.get("content"),n),this.set("dropSide",null)}}),dragOver:function(e){e.preventDefault()},dragEnter:function(){this.set("over",!0)},dragLeave:function(){this.set("over",!1)},drop:function(e){var t=JSON.parse(e.dataTransfer.getData("application/json")),n=this.get("parentView.availableColumns").findBy("name",t.name),a=this.get("content"),i=this.get("columnsNotInHeader");a.findBy("name",n.name)?(console.log("duplicate.. delete me!"),n&&this.set("columnsNotInHeader",i.without(n))):(this.get("content").pushObject(n),droppedItem=i.findBy("name",t.name),droppedItem&&this.set("columnsNotInHeader",i.without(droppedItem))),this.set("over",!1)},insertAt:function(e,t,n){var a,i=this.get("content"),r=i.indexOf(e),o=i.findBy("name",t.get("name"));e.get("name")!==t.get("name")&&(modifiedIndex=r+n,i&&(o&&(a=i.indexOf(o),"number"==typeof a&&(i.arrayContentWillChange(a,1,0),i.splice(a,1),this.set("content",i),i.arrayContentDidChange(a,1,0))),modifiedIndex>i.length?i.pushObject(t):(i.arrayContentWillChange(modifiedIndex,0,1),i.splice(modifiedIndex,0,t),this.set("content",i),i.arrayContentDidChange(modifiedIndex,0,1))))},actions:{insertBefore:function(e,t){this.insertAt(e,t,0)},insertAfter:function(e,t){this.insertAt(e,t,1)}}}),i=e.Component.extend({columns:[],columnsNotInHeader:function(){var e=this.get("availableColumns"),t=this.get("columns");return e.reduce(function(e,n){return t.findBy("name",n.name)||e.pushObject(n),e},[])}.property("availableColumns","columns"),prePopulateColumns:function(){var e=this.get("requiredHeaderItem");this.get("columns").pushObject(e)}.on("init"),data:function(){var t=this.get("datasets"),n=this.get("columns"),a=this;if(!e.isArray(t))throw new Error("Datasets input must be an array.");return t.reduce(function(t,i){if(!e.isArray(i))throw new Error("Dataset must be an array.");var r=i.map(function(e){return n?a.columnAttributeMap(n,e):[e]});return t.concat(r)},[])}.property("datasets","columns.length"),columnAttributeMap:function(e,t){if(t){var n,a=[],i=0;for(n in t)if(t.hasOwnProperty(n)){for(;i<e.length;i++)e[i].attributes.contains(n)&&a.splice(i,0,t[n]);i=0}return a}}});e.Application.initializer({name:"data-table",initialize:function(e){e.register("component:data-table",i),e.register("view:data-table-header",a),e.register("component:data-table-header-bin",t),e.register("component:data-table-header-item",n)}})}(window.Ember);